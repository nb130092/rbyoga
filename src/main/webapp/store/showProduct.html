
<!doctype html>
<html lang="en">
<head>
    <title>场馆产品</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
    <link href='https://fonts.googleapis.com/css?family=Lato:400,300,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>

<!-- 左侧导航！ -->
<div style="float: left; width: 20%;">
    <section class="app">
        <aside class="sidebar">
            <header>场馆导航栏</header>
            <nav class="sidebar-nav">
                <ul>

                    <li>
                        <a href="allStudents.html"><i class="ion-bag"></i> <span>查看所有学员</span></a>
                    </li>

                    <li>
                        <a href="allCoachs.html"><i class="ion-ios-settings"></i> <span class="">查看所有教练</span></a>
                    </li>

                    <li>
                        <a href="#"><i class="ion-ios-briefcase-outline"></i> <span class="">主页</span></a>
                    </li>

                    <li>
                        <a href="#"><i class="ion-ios-analytics-outline"></i> <span class="">场馆业务</span></a>
                        <ul class="nav-flyout">
                            <li>
                                <a href="#"><i class="ion-ios-timer-outline"></i>信息完善</a>
                            </li>
                            <li>
                                <a href="#"><i class="ion-arrow-graph-down-left"></i>我的关注</a>
                            </li>
                            <li>
                                <a href="#"><i class="ion-ios-partlysunny-outline"></i>场馆收入</a>
                            </li>
                            <li>
                                <a href="#"><i class="ion-ios-timer-outline"></i>场馆学员</a>
                            </li>
                            <li>
                                <a href="showStoreYogaCoach.html"><i class="ion-ios-timer-outline"></i>场馆签约教练</a>
                            </li>
                            <li>
                                <a href="#"><i class="ion-ios-timer-outline"></i>场馆通知</a>
                            </li>
                            <li>
                                <a href="showProduct.html"><i class="ion-ios-game-controller-a-outline"></i>场馆产品</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </aside>
    </section>
</div>

<!--右侧窗口-->
<div id="window">
    <br>
    <div><button class="btn btn-success btn-md" data-toggle="modal" data-target="#myModal">add</button></div>
    <div style="width: 800px;border: 1px seagreen solid" id="coachWindow">
        <div class="row">
            <div class="col-sm-6 col-md-3">
                <div class="thumbnail">
                    <img src="/wp-content/uploads/2014/06/kittens.jpg"
                         alt="通用的占位符缩略图">
                    <div class="caption">
                        <h3>缩略图标签</h3>
                        <p>一些示例文本。一些示例文本。</p>
                        <p>
                            <a href="#" class="btn btn-primary" role="button">
                                按钮
                            </a>
                            <a href="#" class="btn btn-default" role="button">
                                按钮
                            </a>
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-md-3">
                <div class="thumbnail">
                    <img src="/wp-content/uploads/2014/06/kittens.jpg"
                         alt="通用的占位符缩略图">
                    <div class="caption">
                        <h3>缩略图标签</h3>
                        <p>一些示例文本。一些示例文本。</p>
                        <p>
                            <a href="#" class="btn btn-primary" role="button">
                                按钮
                            </a>
                            <a href="#" class="btn btn-default" role="button">
                                按钮
                            </a>
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-md-3">
                <div class="thumbnail">
                    <img src="/wp-content/uploads/2014/06/kittens.jpg"
                         alt="通用的占位符缩略图">
                    <div class="caption">
                        <h3>缩略图标签</h3>
                        <p>一些示例文本。一些示例文本。</p>
                        <p>
                            <a href="#" class="btn btn-primary" role="button">
                                按钮
                            </a>
                            <a href="#" class="btn btn-default" role="button">
                                按钮
                            </a>
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-sm-6 col-md-3">
                <div class="thumbnail">
                    <img src="/wp-content/uploads/2014/06/kittens.jpg"
                         alt="通用的占位符缩略图">
                    <div class="caption">
                        <h3>缩略图标签</h3>
                        <p>一些示例文本。一些示例文本。</p>
                        <p>
                            <a href="#" class="btn btn-primary" role="button">
                                按钮
                            </a>
                            <a href="#" class="btn btn-default" role="button">
                                按钮
                            </a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    add
                </h4>
            </div>
            <div class="modal-body">

                <form id="uploadForm" enctype="multipart/form-data" >
                    商品图片:<input id="FileUpload" type="file" name="file"/>
                    商品名称:<input type="text" name="p_name" id="p_name"/>
                    商品价格:<input type="text" name="p_price" id="p_price"/>
                    场馆id:<input type="text" name="store_id" id="store_id"/>
                </form>
                <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                </button>
                <button type="button" class="btn btn-primary"id="upload" >
                    save
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>
</div>

<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel2">
                    update
                </h4>
            </div>
            <div class="modal-body">

                <div id="uploadForm2" enctype="multipart/form-data" >
                    商品图片:<input id="FileUpload2" type="file" name="file2"/>
                    商品名称:<input type="text" name="p_name2" id="p_name2"/>
                    商品价格:<input type="text" name="p_price2" id="p_price2"/>
                    场馆id:<input type="text" name="store_id2" id="store_id2"/>
                    <input  type="hidden" name="p_id2" id="p_id2"/>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                    </button>
                    <button type="button" class="btn btn-primary"id="update" >
                        update
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal -->
    </div>
</div>
<script>

    $(function () {
        showProduct();
        //add
        $("#upload").click(function () {
            // var formdata = new FormData($("#uploadForm")[0]);
            var fileObj = document.getElementById("FileUpload").files[0];   // js 获取文件对象
            if (typeof (fileObj) == "undefined" || fileObj.size <= 0) {
                alert("请选择图片");
                return;
            }
            var formData = new FormData();
            formData.append("file",fileObj); // 加入文件对象
            formData.append("p_name",$("#p_name").val());
            formData.append("p_price",$("#p_price").val());
            formData.append("store_id",$("#store_id").val());
            $.ajax({
                type: "post",
                url: "http://localhost:8888/store/saveProductWithImage", //上传文件的请求路径必须是绝对路劲
                data: formData,
                cache: false,
                processData: false,
                contentType: false,
                success : function(result){
                    alert(result.message);
                    $('#myModal').modal('hide');
                    showProduct();
                }

            });
        });


        $("#update").click(function () {
            // var formdata = new FormData($("#uploadForm")[0]);
            var fileObj = document.getElementById("FileUpload2").files[0];   // js 获取文件对象
            if (typeof (fileObj) == "undefined" || fileObj.size <= 0) {
                alert("请选择图片");
                return;
            }
            var formData = new FormData();
            formData.append("file",fileObj); // 加入文件对象
            formData.append("p_name",$("#p_name2").val());
            formData.append("p_price",$("#p_price2").val());
            formData.append("store_id",$("#store_id2").val());
            formData.append("p_id",$("#p_id2").val());
            $.ajax({
                type: "post",
                url: "http://localhost:8888/store/updateProductWithImage", //上传文件的请求路径必须是绝对路劲
                data: formData,
                cache: false,
                processData: false,
                contentType: false,
                success : function(result){
                    alert(result.message);
                    $('#myModal2').modal('hide');
                    showProduct();
                }

            });
        });
    })



    // 展示场馆的产品
    function showProduct() {
        $.ajax({
            cache:  false,    //是否使用浏览器缓存
            type:  "get",   //请求方式
            url:  "http://localhost:8888/store/showProduct",   //请求路径
            dataType:  "json",  //响应的内容类型
            withCredentials: true ,
            async:  false,     //同步或者异步ajax
            success: function(result) {
                var productStr = "";
                $.each(result.data,function(index,product){
                    productStr+="<div class='col-sm-6 col-md-3 ' >";
                    productStr+="<div class='thumbnail '>";
                    productStr+="<img src='"+product.p_image+"' style='width: 100%;height:175px ' alt='通用的占位符缩略图 '>";
                    productStr+="<div class='caption'>";
                    productStr+="<h3>"+product.p_name+"</h3>";
                    productStr+="<p>"+product.p_price+"￥</p> ";
                    productStr+="<p><button type='button' class='btn btn-primary' onclick='findOneProduct("+product.p_id+")'>修改 </button>";
                    productStr+="<button type='button' class='btn btn-primary' onclick='deleteProduct("+product.p_id+")'>下架 </button>;</p>";
                    productStr+="</div></div></div>";
                });
                $("#coachWindow").html(productStr);
            }
        })
    }

    function deleteProduct(pid){
        $.ajax({
            cache: false,    //是否使用浏览器缓存
            type: "delete",   //请求方式
            url: "http://localhost:8888/products/"+pid,   //请求路径
            dataType:"json",  //响应的内容类型
            async: false,     //同步或者异步ajax
            withCredentials: true ,
            success: function (result) {
                alert(result.message);
                showProduct();
            }
        })
    }

    function findOneProduct(pid){
        $.ajax({
            cache: false,    //是否使用浏览器缓存
            type: "get",   //请求方式
            url: "http://localhost:8888/products/"+pid, //请求路径
            // data:{"pid":pid},
            dataType:"json",  //响应的内容类型
            async: false,     //同步或者异步ajax
            withCredentials: true ,
            success: function (result) {
               // alert(result.data.p_name);
              // document.getElementById("file").value=result.data.p_image;
                document.getElementById("p_name2").value=result.data.p_name;
                document.getElementById("p_price2").value=result.data.p_price;
                document.getElementById("store_id2").value=result.data.store_id;
                document.getElementById("p_id2").value=pid;
                $('#myModal2').modal();
            }
        })
    }


</script>
</body>
</html>
